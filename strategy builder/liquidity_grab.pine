//@version=5
indicator("Liquidity Grab", overlay=true)

// Input parameters
lookback = input.int(5, "Lookback Period", minval=1, maxval=50)

// Color settings
bull_color = input.color(color.green, "Bullish Grab Color")
bear_color = input.color(color.red, "Bearish Grab Color")
line_width = input.int(2, "Line Width", minval=1, maxval=4)

// Get recent high and its location
float recent_high = high[1]
int recent_high_bar = bar_index - 1

// Look back to find if this is the highest in recent bars
for i = 2 to lookback
    if high[i] > recent_high
        recent_high := high[i]
        recent_high_bar := bar_index - i

// Find the lowest low between the recent high and current bar
float lowest_between = low[1]
for i = 1 to bar_index - recent_high_bar
    lowest_between := math.min(lowest_between, low[i])

// Plot for debugging
plot(recent_high, "Recent High", color=color.new(color.blue, 50), style=plot.style_circles)
plot(lowest_between, "Lowest Between", color=color.new(color.yellow, 50), style=plot.style_circles)

// Check for liquidity grab pattern
if high > recent_high and close < lowest_between
    line.new(recent_high_bar, lowest_between, bar_index, lowest_between,
         color=bear_color,
         width=line_width)
    line.new(bar_index, recent_high, bar_index, lowest_between,
         color=bear_color,
         style=line.style_dashed,
         width=1)
    label.new(bar_index, high, "Break â–¼", 
         style=label.style_label_down,
         color=color.new(bear_color, 50),
         textcolor=color.white,
         size=size.tiny)

// Add debugging label
if barstate.islast
    label.new(bar_index, high, 
         text="Recent High: " + str.tostring(recent_high) + 
              "\nLowest Between: " + str.tostring(lowest_between) + 
              "\nCurrent High: " + str.tostring(high),
         style=label.style_label_down,
         color=color.new(color.black, 100),
         textcolor=color.white) 